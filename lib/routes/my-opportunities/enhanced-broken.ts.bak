import { Route } from '@/types';
import { getAllSources } from './config/sources';
import { fetchMultipleSources } from './services/fetcher';
import { fetchMultipleSourcesEnhanced } from './services/enhanced-fetcher';
import { filterItems, deduplicateItems, sortByDate, sortBySalary } from './services/filter';
import { generateHTML } from './templates/generator';

export const route: Route = {
    path: '/dashboard',
    categories: ['other'],
    example: '/my-opportunities/dashboard',
    parameters: {},
    features: {
        requireConfig: false,
        requirePuppeteer: false,
        antiCrawler: false,
        supportBT: false,
        supportPodcast: false,
        supportScihub: false,
    },
    name: '全球高薪前端机会与商机雷达',
    maintainers: ['frontend-hunter'],
    handler,
};

export async function handler(ctx) {
    try {
        // 获取所有数据源
        const allSources = getAllSources();
        
        // 优先选择一些稳定的数据源
        const prioritySources = allSources.filter(s => 
            s.name.includes('V2EX') || 
            s.name.includes('RemoteOK') || 
            s.name.includes('电鸭') ||
            s.name.includes('HN') ||
            s.name.includes('Product Hunt')
        ).slice(0, 20);
        
        // 分离国内外数据源
        {
            name: 'V2EX 酷工作',
            url: 'https://www.v2ex.com/go/jobs',
            type: 'job',
            dataType: 'v2ex-html',
            region: 'CN'
        },
        {
            name: '电鸭社区',
            url: 'https://eleduck.com/api/v1/posts?category=5',
            type: 'job',
            dataType: 'eleduck-json',
            region: 'CN'
        },
        
        // --- 全球远程工作平台 ---
        {
            name: 'RemoteOK Frontend',
            url: 'https://remoteok.com/api?tag=frontend,react,vue,javascript',
            type: 'job',
            dataType: 'remoteok-json',
            region: 'Global'
        },
        {
            name: 'We Work Remotely',
            url: 'https://weworkremotely.com/categories/remote-front-end-programming-jobs.rss',
            type: 'job',
            dataType: 'rss',
            region: 'Global'
        },
        {
            name: 'RemoteLeads',
            url: 'https://remoteleads.io/rss/frontend',
            type: 'job',
            dataType: 'rss',
            region: 'Global'
        },
        {
            name: 'AngelList Remote',
            url: 'https://angel.co/job-collections/remote-frontend-engineer-jobs',
            type: 'job',
            dataType: 'angellist-html',
            region: 'Global'
        },
        {
            name: 'Turing Remote Jobs',
            url: 'https://developers.turing.com/remote-developer-jobs/frontend',
            type: 'job',
            dataType: 'turing-html',
            region: 'Global'
        },
        {
            name: 'Arc Developer Jobs',
            url: 'https://arc.dev/remote-jobs/frontend',
            type: 'job',
            dataType: 'arc-html',
            region: 'Global'
        },
        {
            name: 'FlexJobs Remote',
            url: 'https://www.flexjobs.com/remote-jobs/web-software-development',
            type: 'job',
            dataType: 'flexjobs-html',
            region: 'Global'
        },
        {
            name: 'Toptal Freelance',
            url: 'https://www.toptal.com/developers/front-end/freelance-jobs',
            type: 'job',
            dataType: 'toptal-html',
            region: 'Global'
        },
        
        // --- Hacker News ---
        {
            name: 'HN Who is Hiring',
            url: 'http://hn.algolia.com/api/v1/search_by_date?query="who is hiring"&tags=story',
            type: 'job',
            dataType: 'hn-json',
            region: 'Global'
        },
        {
            name: 'HN Freelancer',
            url: 'http://hn.algolia.com/api/v1/search_by_date?query=freelancer&tags=story',
            type: 'job',
            dataType: 'hn-json',
            region: 'Global'
        },
        
        // --- Reddit 工作板块 ---
        {
            name: 'Reddit r/remotejs',
            url: 'https://www.reddit.com/r/remotejs/new/.rss',
            type: 'job',
            dataType: 'rss',
            region: 'Global'
        },
        {
            name: 'Reddit r/forhire',
            url: 'https://www.reddit.com/r/forhire/search.rss?q=frontend+OR+react+OR+vue&restrict_sr=1&sort=new',
            type: 'job',
            dataType: 'rss',
            region: 'Global'
        },
        {
            name: 'Reddit r/RemoteJobs',
            url: 'https://www.reddit.com/r/RemoteJobs/new/.rss',
            type: 'job',
            dataType: 'rss',
            region: 'Global'
        },
        {
            name: 'Reddit r/WorkOnline',
            url: 'https://www.reddit.com/r/WorkOnline/new/.rss',
            type: 'job',
            dataType: 'rss',
            region: 'Global'
        },
        
        // --- Dev.to Jobs ---
        {
            name: 'Dev.to Remote',
            url: 'https://dev.to/feed/tag/remote',
            type: 'job',
            dataType: 'rss',
            region: 'Global'
        },
        {
            name: 'Dev.to Jobs',
            url: 'https://dev.to/feed/tag/hiring',
            type: 'job',
            dataType: 'rss',
            region: 'Global'
        },
        
        // --- Indeed & LinkedIn (需要特殊处理) ---
        {
            name: 'Indeed Remote Frontend',
            url: 'https://www.indeed.com/jobs?q=frontend+developer+remote+%24120%2C000&l=Remote',
            type: 'job',
            dataType: 'indeed-html',
            region: 'Global'
        },
        {
            name: 'LinkedIn Remote Frontend',
            url: 'https://www.linkedin.com/jobs/remote-frontend-developer-jobs',
            type: 'job',
            dataType: 'linkedin-html',
            region: 'Global'
        },
        
        // ====== 用户痛点与商机数据源 ======
        {
            name: 'V2EX 奇思妙想',
            url: 'https://www.v2ex.com/go/ideas',
            type: 'idea',
            dataType: 'v2ex-html',
            region: 'CN'
        },
        {
            name: 'V2EX 问与答',
            url: 'https://www.v2ex.com/go/qna',
            type: 'idea',
            dataType: 'v2ex-html',
            region: 'CN'
        },
        {
            name: 'V2EX 分享创造',
            url: 'https://www.v2ex.com/go/create',
            type: 'idea',
            dataType: 'v2ex-html',
            region: 'CN'
        },
        {
            name: 'Product Hunt Daily',
            url: 'https://www.producthunt.com/feed',
            type: 'idea',
            dataType: 'rss',
            region: 'Global'
        },
        {
            name: 'Indie Hackers',
            url: 'https://www.indiehackers.com/feed.xml',
            type: 'idea',
            dataType: 'rss',
            region: 'Global'
        },
        {
            name: 'Reddit r/SomebodyMakeThis',
            url: 'https://www.reddit.com/r/SomebodyMakeThis/new/.rss',
            type: 'idea',
            dataType: 'rss',
            region: 'Global'
        },
        {
            name: 'Reddit r/AppIdeas',
            url: 'https://www.reddit.com/r/AppIdeas/new/.rss',
            type: 'idea',
            dataType: 'rss',
            region: 'Global'
        },
        {
            name: 'Reddit r/Startup_Ideas',
            url: 'https://www.reddit.com/r/Startup_Ideas/new/.rss',
            type: 'idea',
            dataType: 'rss',
            region: 'Global'
        },
        {
            name: 'Reddit r/SideProject',
            url: 'https://www.reddit.com/r/SideProject/hot/.rss',
            type: 'idea',
            dataType: 'rss',
            region: 'Global'
        },
        {
            name: 'Reddit r/EntrepreneurRideAlong',
            url: 'https://www.reddit.com/r/EntrepreneurRideAlong/new/.rss',
            type: 'idea',
            dataType: 'rss',
            region: 'Global'
        },
        {
            name: 'Reddit r/Business_Ideas',
            url: 'https://www.reddit.com/r/Business_Ideas/new/.rss',
            type: 'idea',
            dataType: 'rss',
            region: 'Global'
        },
        {
            name: 'Reddit r/Lightbulb',
            url: 'https://www.reddit.com/r/Lightbulb/new/.rss',
            type: 'idea',
            dataType: 'rss',
            region: 'Global'
        },
        {
            name: 'HN Show',
            url: 'http://hn.algolia.com/api/v1/search_by_date?query="Show HN"&tags=story',
            type: 'idea',
            dataType: 'hn-json',
            region: 'Global'
        },
        {
            name: 'HN Ask',
            url: 'http://hn.algolia.com/api/v1/search_by_date?query="Ask HN"&tags=story',
            type: 'idea',
            dataType: 'hn-json',
            region: 'Global'
        },
        {
            name: 'HN Launch',
            url: 'http://hn.algolia.com/api/v1/search_by_date?query="Launch HN"&tags=story',
            type: 'idea',
            dataType: 'hn-json',
            region: 'Global'
        }
    ];

    // 抓取数据的核心函数
    const fetchSource = async (source) => {
        try {
            const cacheKey = `opportunity:${source.name}`;
            const cached = await cache.get(cacheKey);
            if (cached) return cached;

            let items = [];
            
            if (source.dataType === 'v2ex-html') {
                const response = await got.get(source.url, { timeout: 10000 });
                const $ = load(response.data);
                
                $('#TopicsNode .cell').each((_, el) => {
                    const $el = $(el);
                    const titleEl = $el.find('.item_title a');
                    const title = titleEl.text().trim();
                    const link = titleEl.attr('href');
                    const fullLink = link ? `https://www.v2ex.com${link}` : '';
                    
                    const topicInfo = $el.find('.topic_info').text();
                    const author = $el.find('.topic_info strong a').first().text() || 'Unknown';
                    const replyCount = $el.find('.count_livid').text() || '0';
                    
                    if (title && fullLink) {
                        (items as any[]).push({
                            title,
                            link: fullLink,
                            meta: `${author} • ${replyCount} 回复`,
                            author,
                            sourceName: source.name,
                            type: source.type,
                            region: source.region,
                            timestamp: new Date().toISOString()
                        });
                    }
                });
            } else if (source.dataType === 'rss') {
                const feed = await parser.parseURL(source.url);
                items = feed.items.slice(0, 50).map(item => ({
                    title: item.title || 'No Title',
                    link: item.link || '',
                    meta: item.pubDate || '',
                    author: item.creator || item.author || 'Unknown',
                    description: item.contentSnippet || item.content || '',
                    sourceName: source.name,
                    type: source.type,
                    region: source.region,
                    timestamp: item.pubDate || new Date().toISOString()
                }));
            } else if (source.dataType === 'remoteok-json') {
                const response = await got.get(source.url, { timeout: 15000 });
                const data = JSON.parse(response.body);
                
                items = data.slice(0, 100)
                    .filter(d => d.id && d.position)
                    .map(d => {
                        let salary = '';
                        if (d.salary_min && d.salary_max) {
                            salary = `$${d.salary_min}-${d.salary_max}`;
                        }
                        
                        return {
                            title: `${d.company} - ${d.position}`,
                            link: d.url || `https://remoteok.com/remote-jobs/${d.slug}`,
                            meta: `${d.location || 'Worldwide'} ${salary}`,
                            author: d.company,
                            description: d.description || '',
                            tags: d.tags || [],
                            salary: salary,
                            sourceName: source.name,
                            type: source.type,
                            region: source.region,
                            timestamp: d.date || new Date().toISOString()
                        };
                    });
            } else if (source.dataType === 'hn-json') {
                const response = await got.get(source.url, { timeout: 10000 });
                const data = JSON.parse(response.body);
                
                items = data.hits.slice(0, 50).map(h => ({
                    title: h.title || h.story_title || '',
                    link: h.url || `https://news.ycombinator.com/item?id=${h.objectID}`,
                    meta: `${h.points || 0} points • ${h.num_comments || 0} comments`,
                    author: h.author,
                    sourceName: source.name,
                    type: source.type,
                    region: source.region,
                    timestamp: h.created_at
                }));
            } else if (source.dataType === 'eleduck-json') {
                const response = await got.get(source.url, { timeout: 10000 });
                const data = JSON.parse(response.body);
                
                if (data.data && data.data.posts) {
                    items = data.data.posts.slice(0, 50).map(p => ({
                        title: p.title,
                        link: `https://eleduck.com/posts/${p.id}`,
                        meta: `${p.user?.nickname || 'Unknown'} • ${p.comments_count || 0} 评论`,
                        author: p.user?.nickname || 'Unknown',
                        sourceName: source.name,
                        type: source.type,
                        region: source.region,
                        timestamp: p.published_at
                    }));
                }
            }

            if (items.length > 0) {
                await cache.set(cacheKey, items, 600);
            }

            return items;
        } catch (error) {
            console.error(`Failed to fetch ${source.name}:`, (error as Error).message);
            return [];
        }
    };

    // 并行抓取所有数据
    const results = await Promise.allSettled(sources.map(fetchSource));
    const allItems = results
        .filter(r => r.status === 'fulfilled')
        .flatMap(r => r.value);

    // 筛选逻辑
    const { highValueJobs, potentialIdeas } = filterItems(allItems);

    // 生成HTML响应
    const html = generateHTML(highValueJobs, potentialIdeas, allItems, sources.length);
    
    ctx.header('Content-Type', 'text/html; charset=UTF-8');
    return ctx.body(html);
}

// 筛选函数
function filterItems(allItems) {
    // 薪资关键词（月薪 $10k+ 或年薪 $120k+）
    const highSalaryKeywords = [
        '120k', '130k', '140k', '150k', '160k', '170k', '180k', '190k', '200k',
        '250k', '300k', '350k', '400k',
        '10k/month', '12k/month', '15k/month', '20k/month',
        '$10,000/month', '$12,000/month', '$15,000/month',
        '10000/month', '12000/month', '15000/month',
        '$60/hour', '$70/hour', '$80/hour', '$90/hour', '$100/hour',
        '$150/hour', '$200/hour',
        '60/hr', '70/hr', '80/hr', '90/hr', '100/hr',
        '1万/月', '1.2万/月', '1.5万/月', '2万/月', '3万/月',
        '10万/月', '12万/月', '15万/月', '20万/月',
        '年薪百万', '百万年薪',
        'senior', 'staff', 'principal', 'architect', 'lead',
        'equity', 'stock options', 'competitive'
    ];

    // 前端技术关键词
    const frontendKeywords = [
        'frontend', 'front-end', 'front end', 'ui', 'ux',
        'javascript', 'typescript', 'js', 'ts',
        'react', 'vue', 'angular', 'svelte', 'nextjs', 'next.js',
        'nuxt', 'gatsby', 'remix', 'astro',
        'webpack', 'vite', 'rollup', 'esbuild', 'parcel',
        'tailwind', 'sass', 'less', 'styled-components',
        'web developer', 'ui developer', 'ui engineer',
        'frontend developer', 'frontend engineer',
        'fullstack', 'full-stack', 'full stack',
        '前端', 'Web开发', 'UI开发', '全栈'
    ];

    // 用户痛点关键词
    const painPointKeywords = [
        'looking for', 'need help', 'struggling with', 'pain point',
        'frustrated', 'annoying', 'difficult', 'problem',
        'wish there was', 'would pay for', 'willing to pay',
        'shut up and take my money', 'validate', 'mvp',
        'idea validation', 'early adopter', 'beta user',
        '痛点', '需求', '求助', '寻找', '付费',
        '愿意付费', '求购', '需要', '缺少', '没有好的',
        '体验差', '不好用', '难用', '烦人',
        '有没有', '求推荐', '谁能做', '找人开发'
    ];

    // 筛选高薪工作
    const highValueJobs = allItems.filter(item => {
        if (item.type !== 'job') return false;
        
        const text = `${item.title} ${item.description || ''} ${item.meta || ''}`.toLowerCase();
        
        const isFrontend = frontendKeywords.some(k => text.includes(k.toLowerCase()));
        if (!isFrontend) return false;
        
        const hasHighSalary = highSalaryKeywords.some(k => text.includes(k.toLowerCase()));
        
        const isRemotePlatform = [
            'RemoteOK Frontend', 
            'We Work Remotely', 
            'RemoteLeads',
            '电鸭社区',
            'V2EX 远程工作',
            'Reddit r/remotejs',
            'Reddit r/RemoteJobs'
        ].includes(item.sourceName);
        
        const hasRemote = isRemotePlatform || 
            ['remote', 'distributed', 'anywhere', 'worldwide', '远程', '全球'].some(k => text.includes(k));
        
        return hasRemote && (hasHighSalary || isRemotePlatform);
    });

    // 筛选商机
    const potentialIdeas = allItems.filter(item => {
        if (item.type !== 'idea') return false;
        
        const text = `${item.title} ${item.description || ''}`.toLowerCase();
        
        const isIdeaSource = [
            'Reddit r/SomebodyMakeThis',
            'Reddit r/AppIdeas',
            'Reddit r/Startup_Ideas',
            'Product Hunt Daily',
            'Indie Hackers'
        ].includes(item.sourceName);
        
        if (isIdeaSource) return true;
        
        return painPointKeywords.some(k => text.includes(k.toLowerCase()));
    });

    return { highValueJobs, potentialIdeas };
}

// 生成HTML界面
function generateHTML(highValueJobs, potentialIdeas, allItems, sourcesCount) {
    // 生成工作卡片HTML
    const jobCardsHTML = highValueJobs.slice(0, 100).map((job, index) => `
        <div class="job-item card-hover bg-gradient-to-r from-gray-50 to-white border border-gray-200 rounded-xl p-4 mb-3" 
             data-source="${job.sourceName}" 
             data-region="${job.region || 'Global'}"
             data-content="${(job.title + ' ' + (job.description || '')).toLowerCase().replace(/"/g, '&quot;')}"
             data-salary="${extractSalary(job.title + ' ' + job.meta)}">
            <div class="flex justify-between items-start mb-2">
                <span class="text-xs font-semibold text-indigo-600 bg-indigo-50 px-2 py-1 rounded">
                    ${job.sourceName}
                </span>
                <span class="text-xs text-gray-400">${job.region || 'Global'}</span>
            </div>
            <a href="${job.link}" target="_blank" class="block group">
                <h3 class="font-semibold text-gray-900 group-hover:text-indigo-600 transition-colors mb-2 leading-tight">
                    ${escapeHtml(job.title)}
                </h3>
                <div class="flex flex-wrap gap-2 items-center text-xs text-gray-500">
                    ${job.salary ? `<span class="bg-green-100 text-green-700 px-2 py-0.5 rounded font-medium">${job.salary}</span>` : ''}
                    <span class="bg-gray-100 px-2 py-0.5 rounded">${job.author || 'Unknown'}</span>
                    ${job.tags ? job.tags.slice(0, 3).map(tag => 
                        `<span class="bg-blue-50 text-blue-600 px-2 py-0.5 rounded">#${tag}</span>`
                    ).join('') : ''}
                </div>
                ${job.description ? `<p class="text-xs text-gray-600 mt-2 line-clamp-2">${escapeHtml(job.description).substring(0, 150)}...</p>` : ''}
            </a>
        </div>
    `).join('');

    // 生成商机卡片HTML
    const ideaCardsHTML = potentialIdeas.slice(0, 100).map((idea, index) => `
        <div class="idea-item card-hover bg-gradient-to-r from-amber-50 to-white border border-amber-200 rounded-xl p-4 mb-3" 
             data-source="${idea.sourceName}" 
             data-region="${idea.region || 'Global'}"
             data-content="${(idea.title + ' ' + (idea.description || '')).toLowerCase().replace(/"/g, '&quot;')}">
            <div class="flex justify-between items-start mb-2">
                <span class="text-xs font-semibold text-amber-600 bg-amber-50 px-2 py-1 rounded">
                    ${idea.sourceName}
                </span>
                <span class="text-xs text-gray-400">${idea.region || 'Global'}</span>
            </div>
            <a href="${idea.link}" target="_blank" class="block group">
                <h3 class="font-semibold text-gray-900 group-hover:text-amber-600 transition-colors mb-2 leading-tight">
                    ${escapeHtml(idea.title)}
                </h3>
                <div class="text-xs text-gray-500">
                    <span class="bg-gray-100 px-2 py-0.5 rounded">${idea.author || 'Unknown'}</span>
                    <span class="ml-2">${formatDate(idea.timestamp)}</span>
                </div>
                ${idea.description ? `<p class="text-xs text-gray-600 mt-2 line-clamp-2">${escapeHtml(idea.description).substring(0, 150)}...</p>` : ''}
            </a>
        </div>
    `).join('');

    // 使用内联模板
    const template = getInlineTemplate();

    // 替换模板变量
    const html = template
        .replace(/{{SOURCE_COUNT}}/g, sourcesCount.toString())
        .replace(/{{JOB_COUNT}}/g, highValueJobs.length.toString())
        .replace(/{{IDEA_COUNT}}/g, potentialIdeas.length.toString())
        .replace(/{{UPDATE_TIME}}/g, new Date().toLocaleString('zh-CN'))
        .replace('{{JOB_ITEMS}}', jobCardsHTML || '<div class="text-center text-gray-400 py-10">暂无匹配的高薪职位</div>')
        .replace('{{IDEA_ITEMS}}', ideaCardsHTML || '<div class="text-center text-gray-400 py-10">暂无商机信息</div>');

    return html;
}

// 辅助函数
function escapeHtml(text) {
    const map = {
        '&': '&amp;',
        '<': '&lt;',
        '>': '&gt;',
        '"': '&quot;',
        "'": '&#039;'
    };
    return text.replace(/[&<>"']/g, m => map[m]);
}

function extractSalary(text) {
    // 提取薪资数字用于筛选
    const match = text.match(/(\d+)k/i);
    if (match) {
        return parseInt(match[1]) * 1000;
    }
    return '';
}

function formatDate(timestamp) {
    if (!timestamp) return '';
    const date = new Date(timestamp);
    const now = new Date();
    const diffHours = Math.floor((now.getTime() - date.getTime()) / (1000 * 60 * 60));
    
    if (diffHours < 1) return '刚刚';
    if (diffHours < 24) return `${diffHours}小时前`;
    if (diffHours < 168) return `${Math.floor(diffHours / 24)}天前`;
    return date.toLocaleDateString('zh-CN');
}

function getInlineTemplate() {
    return `<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>全球高薪前端机会雷达 | $10k+ Monthly</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; }
        .scrollbar-thin::-webkit-scrollbar { width: 6px; height: 6px; }
        .scrollbar-thin::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 3px; }
        .scrollbar-thin::-webkit-scrollbar-thumb { background: #888; border-radius: 3px; }
        .scrollbar-thin::-webkit-scrollbar-thumb:hover { background: #555; }
        .card-hover { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .card-hover:hover { transform: translateY(-2px); box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); }
        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .line-clamp-2 {
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-50 via-white to-indigo-50 min-h-screen">
    <header class="bg-white/80 backdrop-blur-md border-b border-gray-200 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 py-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-3">
                    <div class="w-12 h-12 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-xl flex items-center justify-center text-white font-bold text-xl">
                        <i class="fas fa-rocket"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold gradient-text">Global Opportunity Radar</h1>
                        <p class="text-xs text-gray-500">Frontend $10k+/month • Remote • Worldwide</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <span class="text-sm text-gray-500">{{SOURCE_COUNT}} 数据源</span>
                    <span class="text-xs text-gray-400 bg-gray-100 px-3 py-1 rounded-full">{{UPDATE_TIME}}</span>
                </div>
            </div>
        </div>
    </header>

    <div class="max-w-7xl mx-auto px-4 py-6">
        <div class="bg-white/60 backdrop-blur-sm rounded-lg p-3 mb-6">
            <div class="flex justify-center items-center space-x-6 text-sm">
                <div class="flex items-center space-x-2">
                    <i class="fas fa-briefcase text-indigo-500"></i>
                    <span><strong>{{JOB_COUNT}}</strong> 个高薪职位</span>
                </div>
                <div class="text-gray-300">|</div>
                <div class="flex items-center space-x-2">
                    <i class="fas fa-lightbulb text-amber-500"></i>
                    <span><strong>{{IDEA_COUNT}}</strong> 个商机</span>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="bg-white rounded-2xl shadow-lg border border-gray-200 overflow-hidden">
                <div class="bg-gradient-to-r from-indigo-500 to-purple-600 p-5">
                    <h2 class="text-xl font-bold text-white flex items-center justify-between">
                        <span class="flex items-center gap-2">
                            <i class="fas fa-briefcase"></i>
                            高薪远程前端职位
                        </span>
                        <span class="bg-white/20 text-white text-sm px-3 py-1 rounded-full">
                            {{JOB_COUNT}}
                        </span>
                    </h2>
                </div>
                <div class="h-[70vh] overflow-y-auto scrollbar-thin p-4">
                    {{JOB_ITEMS}}
                </div>
            </div>

            <div class="bg-white rounded-2xl shadow-lg border border-gray-200 overflow-hidden">
                <div class="bg-gradient-to-r from-amber-500 to-orange-600 p-5">
                    <h2 class="text-xl font-bold text-white flex items-center justify-between">
                        <span class="flex items-center gap-2">
                            <i class="fas fa-lightbulb"></i>
                            用户痛点 & 商机
                        </span>
                        <span class="bg-white/20 text-white text-sm px-3 py-1 rounded-full">
                            {{IDEA_COUNT}}
                        </span>
                    </h2>
                </div>
                <div class="h-[70vh] overflow-y-auto scrollbar-thin p-4">
                    {{IDEA_ITEMS}}
                </div>
            </div>
        </div>
    </div>
</body>
</html>`;
}
